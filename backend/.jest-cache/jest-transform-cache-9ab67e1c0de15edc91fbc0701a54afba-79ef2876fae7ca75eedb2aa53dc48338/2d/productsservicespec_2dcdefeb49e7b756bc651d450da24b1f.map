{"file":"/Users/macm4/Documents/Projek/BUMASansor/backend/src/products/products.service.spec.ts","mappings":";;AAAA,2CAAqD;AACrD,yDAAqD;AAErD,QAAQ,CAAC,iBAAiB,EAAE,GAAG,EAAE;IAC/B,IAAI,OAAwB,CAAC;IAC7B,IAAI,MAAW,CAAC;IAEhB,UAAU,CAAC,GAAG,EAAE;QACd,MAAM,GAAG;YACP,OAAO,EAAE;gBACP,QAAQ,EAAE,IAAI,CAAC,EAAE,EAAE;gBACnB,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE;gBAChB,SAAS,EAAE,IAAI,CAAC,EAAE,EAAE;gBACpB,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE;gBACjB,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE;aAClB;YACD,QAAQ,EAAE;gBACR,SAAS,EAAE,IAAI,CAAC,EAAE,EAAE;aACrB;YACD,YAAY,EAAE,IAAI,CAAC,EAAE,EAAE;SACxB,CAAC;QAEF,MAAM,CAAC,YAAY,CAAC,kBAAkB,CAAC,KAAK,EAAE,GAAU,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAE/E,OAAO,GAAG,IAAI,kCAAe,CAAC,MAAM,CAAC,CAAC;IACxC,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE;QACtB,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAElD,MAAM,MAAM,CACV,OAAO,CAAC,MAAM,CAAC;gBACb,IAAI,EAAE,GAAG;gBACT,UAAU,EAAE,OAAO;gBACnB,QAAQ,EAAE,GAAG;gBACb,SAAS,EAAE,GAAG;gBACd,IAAI,EAAE,KAAK;aACL,CAAC,CACV,CAAC,OAAO,CAAC,cAAc,CAAC,4BAAmB,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;YAC3D,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;YAC7D,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAEvD,MAAM,OAAO,CAAC,MAAM,CAAC;gBACnB,IAAI,EAAE,GAAG;gBACT,OAAO,EAAE,KAAK;gBACd,UAAU,EAAE,OAAO;gBACnB,QAAQ,EAAE,GAAG;gBACb,SAAS,EAAE,GAAG;gBACd,IAAI,EAAE,KAAK;aACL,CAAC,CAAC;YAEV,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,oBAAoB,CAChD,MAAM,CAAC,gBAAgB,CAAC;gBACtB,IAAI,EAAE,MAAM,CAAC,gBAAgB,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC;aAC9D,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["/Users/macm4/Documents/Projek/BUMASansor/backend/src/products/products.service.spec.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\nimport { ProductsService } from './products.service';\n\ndescribe('ProductsService', () => {\n  let service: ProductsService;\n  let prisma: any;\n\n  beforeEach(() => {\n    prisma = {\n      product: {\n        findMany: jest.fn(),\n        count: jest.fn(),\n        findFirst: jest.fn(),\n        create: jest.fn(),\n        update: jest.fn(),\n      },\n      category: {\n        findFirst: jest.fn(),\n      },\n      $transaction: jest.fn(),\n    };\n\n    prisma.$transaction.mockImplementation(async (arr: any[]) => Promise.all(arr));\n\n    service = new ProductsService(prisma);\n  });\n\n  describe('create', () => {\n    it('throws when category not found', async () => {\n      prisma.category.findFirst.mockResolvedValue(null);\n\n      await expect(\n        service.create({\n          name: 'P',\n          categoryId: 'cat-1',\n          buyPrice: 100,\n          sellPrice: 150,\n          unit: 'pcs',\n        } as any),\n      ).rejects.toBeInstanceOf(BadRequestException);\n    });\n\n    it('calculates margin and uses provided barcode', async () => {\n      prisma.category.findFirst.mockResolvedValue({ id: 'cat-1' });\n      prisma.product.create.mockResolvedValue({ id: 'p-1' });\n\n      await service.create({\n        name: 'P',\n        barcode: 'B-1',\n        categoryId: 'cat-1',\n        buyPrice: 100,\n        sellPrice: 150,\n        unit: 'pcs',\n      } as any);\n\n      expect(prisma.product.create).toHaveBeenCalledWith(\n        expect.objectContaining({\n          data: expect.objectContaining({ barcode: 'B-1', margin: 50 }),\n        }),\n      );\n    });\n  });\n});\n"],"version":3}