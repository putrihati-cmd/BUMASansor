{"file":"/Users/macm4/Documents/Projek/BUMASansor/backend/src/sales/sales.service.spec.ts","mappings":"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","names":[],"sources":["/Users/macm4/Documents/Projek/BUMASansor/backend/src/sales/sales.service.spec.ts"],"sourcesContent":["import { BadRequestException } from '@nestjs/common';\nimport { SalesService } from './sales.service';\n\ndescribe('SalesService', () => {\n  let service: SalesService;\n  let prisma: any;\n  let realtime: any;\n\n  beforeEach(() => {\n    prisma = {\n      warung: {\n        findFirst: jest.fn(),\n        update: jest.fn(),\n      },\n      warehouse: {\n        findFirst: jest.fn(),\n      },\n      product: {\n        findMany: jest.fn(),\n      },\n      stock: {\n        findUnique: jest.fn(),\n        update: jest.fn(),\n      },\n      stockMovement: {\n        create: jest.fn(),\n      },\n      sale: {\n        create: jest.fn(),\n        count: jest.fn(),\n      },\n      receivable: {\n        create: jest.fn(),\n      },\n      $transaction: jest.fn(),\n    };\n\n    prisma.$transaction.mockImplementation(async (cb: any) => cb(prisma));\n\n    realtime = { emit: jest.fn() };\n    service = new SalesService(prisma, realtime);\n  });\n\n  describe('create', () => {\n    it('throws when warung is blocked', async () => {\n      prisma.warung.findFirst.mockResolvedValue({\n        id: 'w-1',\n        isBlocked: true,\n        blockedReason: 'overdue',\n      });\n\n      await expect(\n        service.create('u-1', {\n          warungId: 'w-1',\n          warehouseId: 'wh-1',\n          paymentMethod: 'CASH',\n          items: [{ productId: 'p-1', quantity: 1 }],\n        } as any),\n      ).rejects.toBeInstanceOf(BadRequestException);\n    });\n\n    it('throws when paidAmount > totalAmount', async () => {\n      prisma.warung.findFirst.mockResolvedValue({ id: 'w-1', isBlocked: false, creditDays: 14 });\n      prisma.warehouse.findFirst.mockResolvedValue({ id: 'wh-1' });\n      prisma.product.findMany.mockResolvedValue([{ id: 'p-1', sellPrice: 100, deletedAt: null }]);\n\n      await expect(\n        service.create('u-1', {\n          warungId: 'w-1',\n          warehouseId: 'wh-1',\n          paymentMethod: 'CASH',\n          paidAmount: 999,\n          items: [{ productId: 'p-1', quantity: 1 }],\n        } as any),\n      ).rejects.toBeInstanceOf(BadRequestException);\n    });\n\n    it('throws when stock insufficient', async () => {\n      prisma.warung.findFirst.mockResolvedValue({ id: 'w-1', isBlocked: false, creditDays: 14 });\n      prisma.warehouse.findFirst.mockResolvedValue({ id: 'wh-1' });\n      prisma.product.findMany.mockResolvedValue([{ id: 'p-1', sellPrice: 100, deletedAt: null }]);\n\n      prisma.stock.findUnique.mockResolvedValue({ quantity: 0 });\n\n      await expect(\n        service.create('u-1', {\n          warungId: 'w-1',\n          warehouseId: 'wh-1',\n          paymentMethod: 'CASH',\n          items: [{ productId: 'p-1', quantity: 1 }],\n        } as any),\n      ).rejects.toBeInstanceOf(BadRequestException);\n    });\n  });\n});\n"],"version":3}