4b1a08d1a2cf6323cfc7d6c5e5ba3989
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const stocks_service_1 = require("./stocks.service");
describe('StocksService', () => {
    let service;
    let prisma;
    let realtime;
    beforeEach(() => {
        prisma = {
            product: {
                findFirst: jest.fn(),
            },
            stock: {
                findUnique: jest.fn(),
                upsert: jest.fn(),
                update: jest.fn(),
                findMany: jest.fn(),
            },
            warehouse: {
                findFirst: jest.fn(),
            },
            stockMovement: {
                create: jest.fn(),
                findMany: jest.fn(),
            },
            stockOpname: {
                create: jest.fn(),
            },
            $transaction: jest.fn(),
        };
        prisma.$transaction.mockImplementation(async (cb) => cb(prisma));
        realtime = { emit: jest.fn() };
        service = new stocks_service_1.StocksService(prisma, realtime);
    });
    describe('recordMovement', () => {
        it('throws when IN movement missing toWarehouseId', async () => {
            prisma.product.findFirst.mockResolvedValue({ id: 'p-1' });
            await expect(service.recordMovement({
                movementType: 'IN',
                productId: 'p-1',
                quantity: 1,
            }, 'u-1')).rejects.toBeInstanceOf(common_1.BadRequestException);
        });
        it('throws when OUT movement insufficient stock', async () => {
            prisma.product.findFirst.mockResolvedValue({ id: 'p-1' });
            prisma.warehouse.findFirst.mockResolvedValue({ id: 'wh-1' });
            prisma.stock.findUnique.mockResolvedValue({ quantity: 0 });
            await expect(service.recordMovement({
                movementType: 'OUT',
                productId: 'p-1',
                fromWarehouseId: 'wh-1',
                quantity: 10,
            }, 'u-1')).rejects.toBeInstanceOf(common_1.BadRequestException);
        });
    });
    describe('performOpname', () => {
        it('records opname and adjustment movement', async () => {
            prisma.product.findFirst.mockResolvedValue({ id: 'p-1' });
            prisma.warehouse.findFirst.mockResolvedValue({ id: 'wh-1' });
            prisma.stock.upsert.mockResolvedValue({ warehouseId: 'wh-1', productId: 'p-1', quantity: 5 });
            prisma.stock.update.mockResolvedValue({ warehouseId: 'wh-1', productId: 'p-1', quantity: 8 });
            prisma.stockOpname.create.mockResolvedValue({ id: 'op-1' });
            prisma.stockMovement.create.mockResolvedValue({ id: 'mv-1' });
            const result = await service.performOpname({
                warehouseId: 'wh-1',
                productId: 'p-1',
                actualQty: 8,
                reason: 'count',
            }, 'u-1');
            expect(prisma.stock.update).toHaveBeenCalledWith(expect.objectContaining({
                data: { quantity: 8 },
            }));
            expect(prisma.stockOpname.create).toHaveBeenCalledWith(expect.objectContaining({
                data: expect.objectContaining({
                    systemQty: 5,
                    actualQty: 8,
                    difference: 3,
                    reason: 'count',
                    performedBy: 'u-1',
                }),
            }));
            expect(prisma.stockMovement.create).toHaveBeenCalledWith(expect.objectContaining({
                data: expect.objectContaining({
                    movementType: 'ADJUSTMENT',
                    quantity: 3,
                    referenceType: 'OPNAME',
                    referenceId: 'op-1',
                }),
            }));
            expect(result).toHaveProperty('opname');
            expect(result).toHaveProperty('stock');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY200L0RvY3VtZW50cy9Qcm9qZWsvQlVNQVNhbnNvci9iYWNrZW5kL3NyYy9zdG9ja3Mvc3RvY2tzLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDJDQUFxRDtBQUNyRCxxREFBaUQ7QUFFakQsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxPQUFzQixDQUFDO0lBQzNCLElBQUksTUFBVyxDQUFDO0lBQ2hCLElBQUksUUFBYSxDQUFDO0lBRWxCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxNQUFNLEdBQUc7WUFDUCxPQUFPLEVBQUU7Z0JBQ1AsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDckI7WUFDRCxLQUFLLEVBQUU7Z0JBQ0wsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNqQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDcEI7WUFDRCxTQUFTLEVBQUU7Z0JBQ1QsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDckI7WUFDRCxhQUFhLEVBQUU7Z0JBQ2IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2FBQ3BCO1lBQ0QsV0FBVyxFQUFFO2dCQUNYLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2FBQ2xCO1lBQ0QsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDeEIsQ0FBQztRQUVGLE1BQU0sQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLEVBQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFdEUsUUFBUSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUs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QUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FDOUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFO2FBQ3RCLENBQUMsQ0FDSCxDQUFDO1lBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQ3BELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDNUIsU0FBUyxFQUFFLENBQUM7b0JBQ1osU0FBUyxFQUFFLENBQUM7b0JBQ1osVUFBVSxFQUFFLENBQUM7b0JBQ2IsTUFBTSxFQUFFLE9BQU87b0JBQ2YsV0FBVyxFQUFFLEtBQUs7aUJBQ25CLENBQUM7YUFDSCxDQUFDLENBQ0gsQ0FBQztZQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUN0RCxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLElBQUksRUFBRSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7b0JBQzVCLFlBQVksRUFBRSxZQUFZO29CQUMxQixRQUFRLEVBQUUsQ0FBQztvQkFDWCxhQUFhLEVBQUUsUUFBUTtvQkFDdkIsV0FBVyxFQUFFLE1BQU07aUJBQ3BCLENBQUM7YUFDSCxDQUFDLENBQ0gsQ0FBQztZQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hY200L0RvY3VtZW50cy9Qcm9qZWsvQlVNQVNhbnNvci9iYWNrZW5kL3NyYy9zdG9ja3Mvc3RvY2tzLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYWRSZXF1ZXN0RXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgU3RvY2tzU2VydmljZSB9IGZyb20gJy4vc3RvY2tzLnNlcnZpY2UnO1xuXG5kZXNjcmliZSgnU3RvY2tzU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFN0b2Nrc1NlcnZpY2U7XG4gIGxldCBwcmlzbWE6IGFueTtcbiAgbGV0IHJlYWx0aW1lOiBhbnk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgcHJpc21hID0ge1xuICAgICAgcHJvZHVjdDoge1xuICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICBzdG9jazoge1xuICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICAgIHVwc2VydDogamVzdC5mbigpLFxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICB3YXJlaG91c2U6IHtcbiAgICAgICAgZmluZEZpcnN0OiBqZXN0LmZuKCksXG4gICAgICB9LFxuICAgICAgc3RvY2tNb3ZlbWVudDoge1xuICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICBzdG9ja09wbmFtZToge1xuICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICAkdHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgcHJpc21hLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNiOiBhbnkpID0+IGNiKHByaXNtYSkpO1xuXG4gICAgcmVhbHRpbWUgPSB7IGVtaXQ6IGplc3QuZm4oKSB9O1xuICAgIHNlcnZpY2UgPSBuZXcgU3RvY2tzU2VydmljZShwcmlzbWEsIHJlYWx0aW1lKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlY29yZE1vdmVtZW50JywgKCkgPT4ge1xuICAgIGl0KCd0aHJvd3Mgd2hlbiBJTiBtb3ZlbWVudCBtaXNzaW5nIHRvV2FyZWhvdXNlSWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWEucHJvZHVjdC5maW5kRmlyc3QubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3AtMScgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5yZWNvcmRNb3ZlbWVudChcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtb3ZlbWVudFR5cGU6ICdJTicsXG4gICAgICAgICAgICBwcm9kdWN0SWQ6ICdwLTEnLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgICAgfSBhcyBhbnksXG4gICAgICAgICAgJ3UtMScsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9CZUluc3RhbmNlT2YoQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgndGhyb3dzIHdoZW4gT1VUIG1vdmVtZW50IGluc3VmZmljaWVudCBzdG9jaycsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYS5wcm9kdWN0LmZpbmRGaXJzdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncC0xJyB9KTtcbiAgICAgIHByaXNtYS53YXJlaG91c2UuZmluZEZpcnN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICd3aC0xJyB9KTtcbiAgICAgIHByaXNtYS5zdG9jay5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5yZWNvcmRNb3ZlbWVudChcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtb3ZlbWVudFR5cGU6ICdPVVQnLFxuICAgICAgICAgICAgcHJvZHVjdElkOiAncC0xJyxcbiAgICAgICAgICAgIGZyb21XYXJlaG91c2VJZDogJ3doLTEnLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEwLFxuICAgICAgICAgIH0gYXMgYW55LFxuICAgICAgICAgICd1LTEnLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvQmVJbnN0YW5jZU9mKEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncGVyZm9ybU9wbmFtZScsICgpID0+IHtcbiAgICBpdCgncmVjb3JkcyBvcG5hbWUgYW5kIGFkanVzdG1lbnQgbW92ZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWEucHJvZHVjdC5maW5kRmlyc3QubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3AtMScgfSk7XG4gICAgICBwcmlzbWEud2FyZWhvdXNlLmZpbmRGaXJzdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnd2gtMScgfSk7XG5cbiAgICAgIHByaXNtYS5zdG9jay51cHNlcnQubW9ja1Jlc29sdmVkVmFsdWUoeyB3YXJlaG91c2VJZDogJ3doLTEnLCBwcm9kdWN0SWQ6ICdwLTEnLCBxdWFudGl0eTogNSB9KTtcbiAgICAgIHByaXNtYS5zdG9jay51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyB3YXJlaG91c2VJZDogJ3doLTEnLCBwcm9kdWN0SWQ6ICdwLTEnLCBxdWFudGl0eTogOCB9KTtcbiAgICAgIHByaXNtYS5zdG9ja09wbmFtZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ29wLTEnIH0pO1xuICAgICAgcHJpc21hLnN0b2NrTW92ZW1lbnQuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdtdi0xJyB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtT3BuYW1lKFxuICAgICAgICB7XG4gICAgICAgICAgd2FyZWhvdXNlSWQ6ICd3aC0xJyxcbiAgICAgICAgICBwcm9kdWN0SWQ6ICdwLTEnLFxuICAgICAgICAgIGFjdHVhbFF0eTogOCxcbiAgICAgICAgICByZWFzb246ICdjb3VudCcsXG4gICAgICAgIH0gYXMgYW55LFxuICAgICAgICAndS0xJyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWEuc3RvY2sudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGRhdGE6IHsgcXVhbnRpdHk6IDggfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocHJpc21hLnN0b2NrT3BuYW1lLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBkYXRhOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBzeXN0ZW1RdHk6IDUsXG4gICAgICAgICAgICBhY3R1YWxRdHk6IDgsXG4gICAgICAgICAgICBkaWZmZXJlbmNlOiAzLFxuICAgICAgICAgICAgcmVhc29uOiAnY291bnQnLFxuICAgICAgICAgICAgcGVyZm9ybWVkQnk6ICd1LTEnLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWEuc3RvY2tNb3ZlbWVudC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgbW92ZW1lbnRUeXBlOiAnQURKVVNUTUVOVCcsXG4gICAgICAgICAgICBxdWFudGl0eTogMyxcbiAgICAgICAgICAgIHJlZmVyZW5jZVR5cGU6ICdPUE5BTUUnLFxuICAgICAgICAgICAgcmVmZXJlbmNlSWQ6ICdvcC0xJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnb3BuYW1lJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3RvY2snKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==