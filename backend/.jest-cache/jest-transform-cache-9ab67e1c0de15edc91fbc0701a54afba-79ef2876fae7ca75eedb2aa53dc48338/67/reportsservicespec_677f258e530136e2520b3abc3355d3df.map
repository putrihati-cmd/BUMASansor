{"file":"/Users/macm4/Documents/Projek/BUMASansor/backend/src/reports/reports.service.spec.ts","mappings":"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","names":[],"sources":["/Users/macm4/Documents/Projek/BUMASansor/backend/src/reports/reports.service.spec.ts"],"sourcesContent":["import { ReportsService } from './reports.service';\n\ndescribe('ReportsService', () => {\n  let service: ReportsService;\n  let prisma: any;\n\n  beforeEach(() => {\n    prisma = {\n      sale: {\n        aggregate: jest.fn(),\n      },\n      receivable: {\n        aggregate: jest.fn(),\n        findMany: jest.fn(),\n      },\n      warung: {\n        count: jest.fn(),\n        findMany: jest.fn(),\n      },\n      stock: {\n        findMany: jest.fn(),\n      },\n      saleItem: {\n        groupBy: jest.fn(),\n        findMany: jest.fn(),\n      },\n      product: {\n        findMany: jest.fn(),\n      },\n      payment: {\n        aggregate: jest.fn(),\n      },\n      purchaseOrder: {\n        aggregate: jest.fn(),\n      },\n    };\n\n    service = new ReportsService(prisma);\n  });\n\n  describe('dashboard', () => {\n    it('returns expected dashboard shape', async () => {\n      prisma.sale.aggregate.mockResolvedValue({\n        _sum: { totalAmount: 1000, paidAmount: 800 },\n        _count: 2,\n      });\n      prisma.receivable.aggregate.mockResolvedValue({ _sum: { balance: 200 } });\n      prisma.warung.count.mockResolvedValueOnce(5).mockResolvedValueOnce(1);\n\n      prisma.stock.findMany.mockResolvedValue([\n        { quantity: 1, minStock: 10, product: { buyPrice: 100 } },\n        { quantity: 20, minStock: 10, product: { buyPrice: 50 } },\n      ]);\n\n      prisma.saleItem.groupBy.mockResolvedValue([\n        { productId: 'p-1', _sum: { quantity: 10, subtotal: 500 } },\n      ]);\n      prisma.product.findMany.mockResolvedValue([{ id: 'p-1', name: 'P1', barcode: 'B1' }]);\n      prisma.saleItem.findMany.mockResolvedValue([\n        { quantity: 2, price: 10, product: { buyPrice: 7 } },\n      ]);\n      prisma.payment.aggregate.mockResolvedValue({ _sum: { amount: 50 }, _count: 1 });\n      prisma.purchaseOrder.aggregate.mockResolvedValue({ _sum: { totalAmount: 0 } });\n\n      const result = await service.dashboard();\n\n      expect(result).toHaveProperty('today');\n      expect(result).toHaveProperty('receivables');\n      expect(result).toHaveProperty('warungs');\n      expect(result).toHaveProperty('stocks');\n      expect(result).toHaveProperty('topProducts');\n\n      expect(result.today.omzet).toBe(1000);\n      expect(result.today.cashIn).toBe(800);\n      expect(result.today.profitEstimate).toBe(6);\n      expect(result.receivables.outstanding).toBe(200);\n      expect(result.warungs.active).toBe(5);\n      expect(result.warungs.blocked).toBe(1);\n      expect(result.stocks.lowStockCount).toBe(1);\n    });\n  });\n});\n"],"version":3}